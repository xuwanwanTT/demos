<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>加载更多</title>
  <style>
    ul,li {
      margin: 0;
      padding: 0;
    }
  .detail-area > ul > li {
    border: 1px solid #ccc;
    list-style: none;
    margin: 10px 0;
    padding: 10px;
    cursor: pointer;
  }

  .detail-area > ul > li:hover {
    background: green;
  }

  .load {
    text-align: center;
    margin-top: 20px;
  }

  .btn {
    padding: 10px;
    border: 1px solid red;
    border-radius: 3px;
    color: red;
    text-decoration: none;
  }
  </style>
</head>
<body>
  <div class="detail-area">
    <ul> 
      <li>内容1</li>
      <li>内容2</li>    
    </ul>
  </div>
  <div class="load">
    <a class="btn" href="javascript: void(0)">加载更多</a>
  </div>

  <script>
    var btn = document.querySelector('.btn')
    var ul = document.querySelector('.detail-area ul')
    var pageindex = 3
    var isDataArrive = true

    btn.addEventListener('click',function(){
      var xhr = new XMLHttpRequest()

      if(!isDataArrive){return}
      
      xhr.onreadystatechange =function(){
        if(xhr.readyState === 4){
          if(xhr.status === 200 || xhr.status === 304){
            var result = JSON.parse(xhr.responseText)
            var fragment = document.createDocumentFragment()

            for(var i = 0; i < result.length; i++){
              var node = document.createElement('li')
              node.innerText = result[i]
              fragment.appendChild(node)
            }

            ul.appendChild(fragment)
            pageindex = pageindex + 5

          }else { alert('出错啦！')}
          isDataArrive = true
        }
      }
      xhr.open('get','/loadMore?index='+pageindex+'&length=5',true)
      xhr.send()
      isDataArrive = false
    })
  </script>
  
</body>
</html>
